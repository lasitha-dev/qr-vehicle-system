<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Vehicle - QR Vehicle System</title>
    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(#eef2f5, #d9e2ec);
            margin: 0;
            padding: 30px;
        }

        /* Main content box */
        #main {
            max-width: 850px;
            margin: 0 auto;
            padding: 30px;
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Heading */
        h2 {
            margin-top: 0;
            color: #1a3c6e;
            font-size: 26px;
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }

        /* Info Card */
        .infoCard {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            background: #f7fbff;
            border-left: 5px solid #1a73e8;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .person-photo {
            width: 80px;
            height: 100px;
            border-radius: 6px;
            object-fit: cover;
            border: 1px solid #ccc;
        }

        .person-photo-placeholder {
            width: 80px;
            height: 100px;
            background: #ddd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #444;
            border: 1px solid #ccc;
            text-align: center;
        }

        .infoLabel {
            font-size: 18px;
            font-weight: 700;
            color: #222;
            text-transform: uppercase;
        }

        .infoSub {
            font-size: 14px;
            margin-top: 5px;
            color: #444;
            text-transform: uppercase;
        }

        .small {
            color: #666;
            font-size: 13px;
            margin-top: 8px;
        }

        /* Messages */
        .message {
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 15px;
            font-weight: 500;
        }

        .message.success {
            background: #e7fff1;
            border-left: 5px solid #3cbc68;
            color: #1e5733;
        }

        .message.error {
            background: #ffe6e6;
            border-left: 5px solid #ff4d4d;
            color: #8b0000;
        }

        /* Form Design */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-weight: 600;
            color: #1a3c6e;
            font-size: 15px;
            margin-bottom: 5px;
            display: block;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select,
        input[type="file"] {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccd8e0;
            background: #f8fbfd;
            font-size: 15px;
            transition: 0.2s;
            width: 100%;
            max-width: 400px;
            /* Limit input width to match screenshot roughly */
            box-sizing: border-box;
        }

        input[type="file"] {
            padding: 8px;
            background: #fff;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        select:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 5px rgba(26, 115, 232, 0.3);
        }

        /* Button */
        button {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.25s;
            width: 100%;
            margin-top: 15px;
        }

        button:hover {
            background: #1557b0;
            transform: translateY(-2px);
        }

        /* Vehicle List */
        .vehicleList {
            background: #f9fbff;
            padding: 15px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 4px solid #1a73e8;
        }

        .vehicleList h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
            color: #222;
        }

        .vehicleItem {
            margin-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .vehicleItem:last-child {
            border-bottom: none;
            margin-bottom: 0px;
            padding-bottom: 0px;
        }

        .vehicleItem strong {
            color: #222;
            font-size: 16px;
        }

        .vehicleItem .small {
            font-size: 12px;
            color: #666;
            display: block;
            margin-top: 4px;
        }

        .badge-pending {
            background: #f0ad4e;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-approved {
            background: #5cb85c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-rejected {
            background: #d9534f;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Uploaded Certificates List */
        .certList h4 {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 15px;
            color: #222;
        }

        .certList ul {
            margin: 0;
            padding-left: 20px;
        }

        .certList li {
            margin-bottom: 5px;
        }

        .certList a {
            color: blue;
            text-decoration: underline;
            font-size: 14px;
        }

        /* Back link */
        .backLink {
            text-align: center;
            margin-top: 25px;
        }

        .backLink a {
            color: #1a3c6e;
            text-decoration: none;
            font-weight: 600;
        }

        .backLink a:hover {
            text-decoration: underline;
        }

        /* Fade In animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <div id="main">
        <h2>Register Vehicle</h2>

        <!-- Alerts -->
        <div th:if="${success}" class="message success" th:text="'âœ… ' + ${success}"></div>
        <div th:if="${error}" class="message error" th:text="'âŒ ' + ${error}"></div>

        <!-- Person Info Card -->
        <div class="infoCard" th:if="${personName}">
            <img th:if="${personImageUrl}" th:src="${personImageUrl}" alt="Photo" class="person-photo"
                onerror="this.outerHTML='<div class=\'person-photo-placeholder\'>No Image</div>'">
            <div th:unless="${personImageUrl}" class="person-photo-placeholder">No Image</div>

            <div>
                <div class="infoLabel">
                    <span th:text="${personName}">Person Name</span>
                    (<span th:text="${userId}">ID</span>)
                </div>

                <div class="infoSub">
                    <!-- Student-specific info -->
                    <th:block th:if="${category == 'student'}">
                        <span th:if="${personFaculty}" th:text="${personFaculty}">Faculty</span>
                        <span th:if="${personCourse}" th:text="' â€¢ ' + ${personCourse}">Course</span>
                        <span th:if="${personSemester}" th:text="' â€¢ Semester: ' + ${personSemester}">Semester</span>
                    </th:block>

                    <!-- Staff-specific info -->
                    <th:block th:if="${category != 'student'}">
                        <span th:if="${personDepartment}" th:text="${personDepartment}">Department</span>
                        <span th:if="${personDesignation}" th:text="' â€¢ ' + ${personDesignation}">Designation</span>
                    </th:block>
                </div>

                <div class="small">
                    Category: <strong th:text="${#strings.capitalize(category)}">Category</strong>
                    <span th:if="${personSemesterRegDate}"
                        th:text="' â€¢ Registered: ' + ${personSemesterRegDate}"></span>
                </div>
            </div>
        </div>

        <!-- Add New Vehicle Form -->
        <form th:action="@{/my/vehicle/add}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="userId" th:value="${userId}">
            <input type="hidden" name="category" th:value="${category}">

            <div>
                <label>Vehicle Number:</label>
                <input type="text" name="vehicleNo" required pattern="[A-Za-z0-9/\-\s]+"
                    title="Letters, numbers, /, - and spaces only">
            </div>

            <div>
                <label>Vehicle Owner Name:</label>
                <input type="text" name="owner" required th:value="${personName}">
            </div>

            <div>
                <label>Vehicle Type</label>
                <select name="vehicleTypeId" required>
                    <option value="">-- Select Vehicle Type --</option>
                    <option th:each="vt : ${vehicleTypes}" th:value="${vt.id}"
                        th:text="${vt.icon + ' ' + vt.displayName}">Type</option>
                </select>
            </div>

            <div>
                <label>Mobile No:</label>
                <input type="tel" name="mobile" required pattern="\+?\d{7,15}"
                    title="Enter a valid phone number (7-15 digits)">
            </div>

            <div>
                <label>Email Address:</label>
                <input type="email" name="email" required>
            </div>

            <div>
                <label>Upload Registration Certificate:</label>
                <input type="file" name="certificate" accept="application/pdf" required>
            </div>

            <button type="submit">Register Vehicle</button>
        </form>

        <!-- Existing Vehicles List -->
        <div class="vehicleList" th:if="${existingVehicles != null and not #lists.isEmpty(existingVehicles)}">
            <h3>Registered Vehicles</h3>
            <ul style="padding-left: 20px; list-style-type: disc; margin: 0;">
                <li th:each="v : ${existingVehicles}" class="vehicleItem">
                    <strong th:text="${v.vehicleTypeIcon + ' ' + v.vehicleNo}">ðŸš— Vehicle No</strong>
                    <br>
                    <span th:text="${v.owner}" style="color: #444; font-size: 14px;">Owner Name</span>
                    <span class="small">
                        <span th:text="${v.category}">Type</span>
                        <span th:if="${v.createdDate != null}"
                            th:text="' | ' + ${#strings.substring(v.createdDate, 0, 19)}">Date</span>
                        <span th:if="${v.mobile != null}" th:text="' | ' + ${v.mobile}">Mobile</span>
                        <span th:text="' | studservices'">studservices</span>
                        <!-- Status Badge -->
                        <span th:class="${v.approvalStatus == 'Approved' ? 'badge-approved' : 
                                        (v.approvalStatus == 'Pending' ? 'badge-pending' : 'badge-rejected')}"
                            th:text="${v.approvalStatus}" style="margin-left: 5px;">Status</span>
                    </span>
                </li>
            </ul>
        </div>

        <!-- Uploaded Certificates -->
        <div class="certList" th:if="${certificates != null and not #lists.isEmpty(certificates)}">
            <h4>Uploaded Certificates:</h4>
            <ul>
                <li th:each="cert : ${certificates}">
                    <a th:href="@{'/Certificate/Student/' + ${userIdPrefix} + '/' + ${userIdYear} + '/' + ${cert}}"
                        target="_blank" th:text="${cert}">certificate.pdf</a>
                </li>
            </ul>
        </div>

        <div class="backLink">
            <a th:href="@{/dashboard}">Back to Dashboard</a>
        </div>
    </div>
</body>

</html>